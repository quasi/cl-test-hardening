# Canon Fix Plan

Generated: 2026-01-27T20:36:00Z
Canon: ./canon/
Status: INITIALIZED (needs detail extraction)

## Summary

| Category | Fixes | Priority |
|----------|-------|----------|
| Structure | 1 | medium |
| Content | 4 | high |
| Observations | 1 | low |

## CCC Evaluation Results

```
Canon Completion Contract: PARTIAL
==================================================
Total: 12 | Passed: 6 | Failed: 4 | Deferred: 2

✓ [PASS] context.manifest_exists: canon.yaml exists
✓ [PASS] context.manifest_valid: canon.yaml has valid structure
✗ [FAIL] context.readme_canonical_exists: README-CANON.md not found
✓ [PASS] context.structure_valid: Required directory structure exists
✓ [PASS] vocab.file_exists: Core vocabulary file exists
✗ [FAIL] feature.has_contracts: All features missing contracts
✗ [FAIL] feature.has_scenarios: All features missing scenarios
✗ [FAIL] feature.has_properties: Properties directories not created
✓ [PASS] state.no_blocking_checkpoints: _initiate complete
→ [DEFERRED] contracts: Full extraction deferred during initiation
→ [DEFERRED] scenarios: Full extraction deferred during initiation
```

**Overall Status**: Canon structure is sound but needs detailed contract and scenario extraction.

## Fixes

### HIGH: Extract Contracts for All Features

**Issue**: All 4 features (property, mutation, contract, agent) have no contracts yet.

**Context**: During initiation, contract extraction was deferred. Feature.yaml files exist with metadata, but contract/ directories are empty.

**Action**: Extract contracts from code for each module:

1. **Property module**: Extract from `src/property/package.lisp` exports
   - Generator contracts (gen-integer, gen-string, etc.)
   - Property verification contracts
   - Shrinking contracts

2. **Mutation module**: Extract from `src/mutation/package.lisp` exports
   - Mutation operator contracts
   - Mutant runner contracts
   - Mutation scoring contracts

3. **Contract module**: Extract from `src/contract/package.lisp` exports
   - Consumer contract definition
   - Provider verification contracts
   - Pact generation contracts

4. **Agent module**: Extract from `src/agent/package.lisp` exports
   - Verification dimension contracts
   - Violation detection contracts
   - Agent reporting contracts

**Command**: `/canon specify --extract-contracts`

**Status**: MANUAL (requires code analysis and contract writing)

---

### HIGH: Extract Scenarios for All Features

**Issue**: All 4 features have no scenarios yet.

**Context**: During initiation, scenario extraction was deferred. Test files exist (`tests/*-tests.lisp`) but haven't been converted to scenarios.

**Action**: Extract scenarios from test files:

1. **Property module**: From `tests/property-tests.lisp`, `tests/generator-tests.lisp`, `tests/shrinking-tests.lisp`
2. **Mutation module**: From `tests/mutation-tests.lisp`
3. **Contract module**: From `tests/contract-tests.lisp`
4. **Agent module**: From `tests/agent-tests.lisp`

**Command**: `/canon specify --extract-scenarios`

**Status**: MANUAL (requires test analysis and scenario writing)

---

### HIGH: Create Properties Directories

**Issue**: No `properties/` directories exist for features.

**Action**: Create properties directories and document invariants:

```bash
mkdir -p canon/features/property/properties
mkdir -p canon/features/mutation/properties
mkdir -p canon/features/contract/properties
mkdir -p canon/features/agent/properties
```

Then document key properties from code (validation rules, invariants, constraints).

**Status**: AUTO (directory creation) + MANUAL (property documentation)

---

### MEDIUM [AUTO]: Create README-CANON.md

**Issue**: README-CANON.md not found in Canon root.

**Action**: Create canonical README explaining the Canon specification.

**Content Template**:
```markdown
# Canon Specification for cl-test-hardening

This is the formal specification for cl-test-hardening, a test hardening library for Common Lisp.

## Purpose

This Canon serves as the authoritative specification for:
- Module contracts and interfaces
- Expected behaviors across all modules
- Domain vocabulary and concepts
- Architectural decisions

## Structure

- `core/foundation/` - Vocabulary and ontology
- `features/` - Module specifications (property, mutation, contract, agent)
- `verification/` - How to verify implementation matches spec

## Verification

Run the test suite to verify implementation:
```lisp
(ql:quickload "cl-test-hardening/tests")
(5am:run! :th.tests)
```

## Confidence

Extraction confidence: 0.94 (very high)
See `.canon-initiation/triangulation-report.md` for details.
```

**Status**: AUTO (will be created)

---

### LOW: Review Observation

**Issue**: One observation pending review (Canon adapter not documented).

**Location**: `.canon-initiation/observations.yaml` obs-init-001

**Action**: Update `README.md` to include Canon adapter in module list:

```markdown
## Modules

- **property** - Property-based testing with shrinking
- **mutation** - Mutation testing for test quality verification
- **contract** - Consumer-driven contract testing (Pact-style)
- **agent** - AI-generated code verification
- **canon** - Canon specification integration
```

**Status**: MANUAL (requires README update)

---

## Execution Plan

### Immediate (AUTO fixes)

1. Create `README-CANON.md` ✓ (will apply with --fix)
2. Create properties directories ✓ (will apply with --fix)

### Next Steps (MANUAL)

1. **Extract contracts**: `/canon specify --extract-contracts`
   - Analyze package exports for each module
   - Write contract specifications in Markdown
   - Link contracts to scenarios

2. **Extract scenarios**: `/canon specify --extract-scenarios`
   - Convert test cases to scenario format
   - Ensure scenario coverage matches tests
   - Link scenarios to contracts

3. **Document properties**: Add property specifications
   - Identify invariants from code
   - Document validation rules
   - Specify constraints and guarantees

4. **Resolve observation**: Update README.md to document Canon adapter

### Recommended Workflow

```bash
# 1. Apply automatic fixes
/canon check --fix

# 2. Extract contracts (most important)
/canon specify --extract-contracts

# 3. Extract scenarios
/canon specify --extract-scenarios

# 4. Document properties
/canon specify --extract-properties

# 5. Final verification
/canon verify
```

## Notes

**Why were contracts/scenarios deferred during initiation?**

The `_initiate` skill performs high-level structural extraction to establish the Canon framework quickly. Detailed contract and scenario extraction is intentionally deferred because:

1. It requires deeper code analysis
2. It's more appropriate for the `/canon specify` workflow
3. The structural foundation (vocabulary, ontology, feature metadata) had to be established first

This is normal and expected. The Canon is in INITIALIZED state and ready for detailed specification work.

**Current Canon Phase**: INITIALIZED → Ready for `/canon specify`
